<!--IconValuesStart-->
{
"music":"audiotrack",
"video":"ondemand_video",
"img":"image",
"pdf":"picture_as_pdf",
"txt":"description",
"apk":"android",
"exe":"desktop_windows",
"default":"insert_drive_file"
}
<!--IconValuesEnd-->

<!DOCTYPE html>
<html lang="<!--constStr@language-->">

<head>
    <link rel="preconnect" href="//fastly.jsdelivr.net/npm" />

    <meta charset="utf-8" />
    <meta http-equiv="" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#fff" />

    <!--BackgroundMStart-->
    <link rel="icon" href="<!--BackgroundMUrl-->" type="image/x-icon" />
    <!--BackgroundMEnd-->
    <title>
        <!--Title-->
    </title>
    <meta name="keywords" content="<!--Keywords-->" />
    <meta name="description" content="<!--Description-->" />

    <link rel="stylesheet"
        href="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/css/app1@uw34ru4ehdn4pywddmebm79dnnb2jyei.css" />
    <link rel="stylesheet"
        href="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/css/app2@eqge353pwpgivauvcvzejwrki4mdissj.css" />

    <link rel="stylesheet" href="//fastly.jsdelivr.net/npm/@fontsource/noto-sans-tc/500.css" />
    <link rel="stylesheet" href="//fastly.jsdelivr.net/npm/@fontsource/noto-sans-sc/500.css" />
    <link rel="stylesheet" href="//fastly.jsdelivr.net/npm/@fontsource/noto-sans-hk/500.css" />

    <link rel="stylesheet" href="//fastly.jsdelivr.net/npm/mdui@1.0.1/dist/css/mdui.min.css" />
    <link rel="stylesheet" href="//fastly.jsdelivr.net/npm/@fontsource/fira-code@4.2.2/400.css" />
    <link rel="stylesheet" href="//fastly.jsdelivr.net/npm/@highlightjs/cdn-assets/styles/github.min.css" />

    <script src="//fastly.jsdelivr.net/npm/dplayer/dist/DPlayer.min.js"></script>
    <link rel="stylesheet" href="//fastly.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" />
    <script src="//fastly.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
    <script src="//fastly.jsdelivr.net/npm/jsmediatags/dist/jsmediatags.min.js"></script>

    <script>
        window.disableddarkmode = true;
    </script>

    <style>
        html {
            background-color: #222222;
            background-repeat: no-repeat;
            background-size: cover;
            background-attachment: fixed;
            background-image: url("<!--BackgroundUrl-->") !important;
        }

        body {
            background: inherit;
            margin: 0;
            background-attachment: fixed;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .mdui-theme-layout-dark {
            background-color: #222222 !important;
        }

        * {
            color: #ffd2b3;
            font-family: 'Noto Sans TC', 'Noto Sans SC', 'Noto Sans HK', sans-serif;
        }

        #footer {
            color: #fff;
        }

        .mdui-typo code,
        .mdui-typo kbd {
            color: #7787ff;
            background-color: #dfdfdf;
            border-radius: 6px
        }

        .mdui-theme-layout-dark .mdui-list-item-active {
            --color-active: #ff4081 !important;
        }

        .mdui-icon {
            color: #fff8f3;
        }

        .mdui-menu {
            background-color: rgb(22 22 22 / 43%);
        }

        .mdui-dialog {
            background-color: rgb(38 38 38);
        }

        .mdui-chip .mdui-chip-title {
            color: #fff;
            font-weight: 600;
        }

        div#file {
            background-color: rgb(22 22 22 / 43%);
        }

        .mdui-typo p {
            margin: 0 0 0 0;
        }

        .markdown p {
            margin: 0 0 1.2em 0;
        }

        .mdui-typo {
            line-height: 1.8;
        }

        .markdown code,
        .mdui-typo code {
            padding: 2px 4px !important;
            color: #e3adff !important;
            background-color: #464646 !important;
        }

        .markdown a *,
        .mdui-typo a * {
            color: #ff4d7e !important;
        }

        .mdui-theme-layout-dark .mdui-list-item {
            color: #ffd2b3;
        }

        .mdui-list-item:hover {
            background-color: #ffffff29;
        }

        div#aplayer * {
            color: #666;
        }

        input#url-input {
            color: rgb(103 95 217);
        }

        label.mdui-textfield-label {
            color: #e91e63 !important;
        }

        .clp {
            margin: 0.25rem;
            color: #1A202C;
            font-weight: bold;
            border-radius: 0.375rem;
            height: 2.5rem;
            width: auto;
            line-height: 1.2;
            display: flex;
            justify-content: center;
            flex-direction: column;
            align-items: center;
        }

        #openiina {
            background: #D6BCFA;
        }

        #openpot {
            background: #FAF089;
        }

        #openvlc {
            background: #FBD38D;
        }

        #opennp {
            background: #81E6D9;
        }

        #openmxfree {
            background: #90cdf4;
        }

        #openmxpro {
            background: #90cdf4;
        }

        #clpp {
            line-height: 1.2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            -webkit-box-pack: center;
            list-style-type: none;
            align-items: center;
            padding: 0px;
            margin: -0.25rem;
        }

        .blur {
            z-index: 0;
            position: fixed;
            width: 100%;
            height: 100%;
            left: 0;
            filter: blur(0px);
        }

        ul.mdui-menu {
            position: fixed !important;
        }

        .aplayer,
        .aplayer-pic {
            padding: inherit;
            border-radius: 10px;
        }

        .mdui-menu {
            width: auto;
        }
    </style>

    <!--customCss-->
</head>

<body>
    <div class="blur"></div>
</body>

<body class="mdui-appbar-with-toolbar mdui-theme-layout-auto mdui-drawer-body-left mdui-theme-accent-pink">
    <header class="mdui-appbar mdui-appbar-fixed">
        <div class="mdui-toolbar">
            <span class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white"
                onclick='mdui.$(".mdui-appbar-with-toolbar").toggleClass("mdui-drawer-body-left");'
                id="toggle-drawer"><i class="mdui-icon material-icons">menu</i></span>
            <a class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white" onclick="window.history.back()">
                <i class="mdui-icon material-icons">arrow_back</i>
            </a>
            <a href="<!--base_path-->" class="mdui-typo-headline">
                <!--Sitename-->
            </a>
            <!--DiskPathArrayStart-->
            <i class="mdui-icon material-icons mdui-hidden-xs" style="margin: 0">chevron_right</i><a
                href="<!--PathArrayLink-->" class="mdui-typo-subheading mdui-hidden-xs">
                <!--PathArrayName-->
            </a>
            <!--DiskPathArrayEnd-->
            <div class="mdui-toolbar-spacer"></div>
        </div>
    </header>
    <div class="mdui-drawer" id="main-drawer">
        <div class="mdui-list" mdui-collapse="{accordion: true}">
            <!--LoginStart-->
            <li class="mdui-list-item mdui-ripple" mdui-dialog="{target: '#login_input'}">
                <a class="mdui-list-item-icon mdui-icon material-icons">account_circle</a>
                <a class="mdui-list-item-content" mdui-dialog="{target: '#login_input'}">
                    <!--constStr@Login-->
                </a>
            </li>
            <!--LoginEnd-->
            <li class="mdui-list-item mdui-ripple" onclick="renexmoe.toggle_theme();">
                <a class="mdui-list-item-icon mdui-icon material-icons">brightness_4</a><a
                    class="mdui-list-item-content">深色背景模式</a>
            </li>
            <li class="mdui-list-item mdui-ripple">
                <a href="<!--base_path-->" class="mdui-list-item-icon mdui-icon material-icons">home</a><a
                    href="<!--base_path-->" class="mdui-list-item-content" id="home">
                    <!--constStr@Home-->
                </a>
            </li>
            <!--MultiDiskAreaStart-->
            <div class="mdui-divider"></div>
            <!--MultiDisksStart-->
            <li class="mdui-list-item mdui-ripple">
                <a href="<!--MultiDisksUrl-->" class="mdui-list-item-icon mdui-icon material-icons">cloud</a>
                <a href="<!--MultiDisksUrl-->" class="mdui-list-item-content mdui-text-truncate disk_name">
                    <!--MultiDisksName-->
                </a>
            </li>
            <!--MultiDisksEnd-->
            <div class="mdui-divider"></div>
            <!--MultiDiskAreaEnd-->
            <a target="_blank" href="https://github.com/qkqpttgf/OneManager-php" class="mdui-list-item mdui-ripple">
                <i class="mdui-list-item-icon mdui-icon material-icons">code</i>
                <div class="mdui-list-item-content">Github</div>
            </a>
            <li class="mdui-list-item mdui-ripple" id="about_theme">
                <i class="mdui-list-item-icon mdui-icon material-icons">info</i>
                <div class="mdui-list-item-content">關於主題</div>
            </li>
            <div class="mdui-divider"></div>
            <li class="mdui-list-item mdui-ripple" id="select_language" style="overflow: visible;">
                <i class="mdui-list-item-icon mdui-icon material-icons">language</i>
                <div class="mdui-list-item-content" style="padding-top: 10px;padding-bottom: 10px;">
                    <select class="mdui-select" name="language" mdui-select
                        onchange="changelanguage(this.options[this.options.selectedIndex].value)">
                        <!--SelectLanguageStart-->
                        <option value="<!--SelectLanguageKey-->" <!--SelectLanguageSelected-->>
                            <!--SelectLanguageValue-->
                        </option>
                        <!--SelectLanguageEnd-->
                    </select>
                </div>
            </li>
            <script>
                function changelanguage(str) {
                    if (str == 'Language') str = '';
                    var expd = new Date();
                    expd.setTime(expd.getTime() + (2 * 60 * 60 * 1000));
                    var expires = "expires=" + expd.toGMTString();
                    document.cookie = 'language=' + str + '; path=/; ' + expires;
                    location.href = location.href;
                }
            </script>
        </div>
    </div>
    <div class="mdui-container" style="position: relative;">
        <ul class="mdui-menu" id="admin-menu">
            <li class="mdui-menu-item">
                <a href="javascript:;" class="mdui-ripple back">
                    <i class="mdui-menu-item-icon mdui-icon material-icons">arrow_back</i>
                    返回上一頁
                </a>
            </li>
        </ul>
        <i id="mouseplace" style="position: fixed"></i>

        <!--LoginStart-->
        <div class="mdui-dialog" id="login_input">
            <div class="mdui-dialog-title">
                <!--constStr@Login-->
            </div>
            <div class="mdui-dialog-content" style="height: 108px">
                <form action="<!--IsPreview?-->login=admin" method="post" onsubmit="return sha1loginpass(this);">
                    <div class="mdui-textfield mdui-textfield-floating-label">
                        <i class="mdui-icon material-icons">lock</i><label class="mdui-textfield-label">
                            <!--constStr@InputPassword-->
                        </label>
                        <input class="mdui-textfield-input" id="login_input" name="password1" type="password">
                        <input name="timestamp" type="hidden" value="">
                    </div>
            </div>
            <div class="mdui-dialog-actions">
                <button class="mdui-btn mdui-ripple" mdui-dialog-close="" id="login_close">取消</button>
                <button id="login_btn_bak" class="mdui-btn mdui-ripple" type="submit" value="<!--constStr@Login-->">
                    <!--constStr@Login-->
                </button>
                </form>
            </div>
        </div>
        <!--LoginEnd-->
        <!--EncryptedStart-->
        <div class="mdui-center" style="margin: 20px auto;max-width: 600px;">
            <br />
            <center>
                <div class="mdui-typo-title">
                    這是一個受保護的資料夾，您需要提供訪問密碼才能檢視。
                </div>
            </center>
            <form action="" method="post">
                <div class="mdui-textfield mdui-textfield-floating-label">
                    <i class="mdui-icon material-icons">https</i>
                    <label class="mdui-textfield-label">
                        <!--constStr@InputPassword-->
                    </label>
                    <input name="password1" class="mdui-textfield-input" type="password" />
                </div>
                <br />
                <button type="submit" class="mdui-center mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme">
                    <i class="mdui-icon material-icons">fingerprint</i>
                    <!--constStr@Submit-->
                </button>
            </form>
        </div>
        <!--EncryptedEnd-->

        <!--GuestUploadStart-->
        <div id="upload_div" style="padding:0 0 16px 0">
            <div id="upload_btns" align="center">
                <select onchange="document.getElementById('upload_file').webkitdirectory=this.value;">
                    <option value="">
                        <!--constStr@UploadFile-->
                    </option>
                    <option value="1">
                        <!--constStr@UploadFolder-->
                    </option>
                </select>
                <input id="upload_file" type="file" name="upload_filename" multiple="multiple">
                <input id="upload_submit" onclick="preup();" value="<!--constStr@Upload-->" type="button">
            </div>
        </div>
        <!--GuestUploadEnd-->

        <!--IsFolderStart-->
        <!--HeadomfStart-->
        <div class="mdui-typo mdui-shadow-3" style="padding: 20px; margin: 20px 0">
            <!--HeadomfContent-->
        </div>
        <!--HeadomfEnd-->
        <!--HeadmdStart-->
        <div class="mdui-chip mdui-ripple mdui-hidden-xs" style="margin-top: 20px;">
            <span class="mdui-chip-icon">
                <i class="mdui-icon material-icons">face</i>
            </span>
            <span class="mdui-chip-title">HEAD.md</span>
        </div>
        <div class="mdui-typo mdui-shadow-3 markdown"
            style="padding: 20px; margin: 20px 0; overflow-x: scroll; border-radius: 8px; background-color: rgb(22 22 22 / 43%);"
            id="head">
            <textarea id="head-md"><!--HeadmdContent--></textarea>
        </div>
        <!--HeadmdEnd-->
        <div class="mdui-row mdui-shadow-3"
            style="margin: 20px 0; border-radius: 8px; background-color: rgb(22 22 22 / 43%);">
            <ul class="mdui-list" id="file-list">
                <li class="mdui-list-item mdui-ripple">
                    <div class="mdui-row mdui-col-xs-12">
                        <div class="mdui-col-xs-12 mdui-col-sm-7">
                            <!--constStr@File--><i class="mdui-icon material-icons icon-sort" data-sort="name"
                                data-order="less">expand_less</i>
                        </div>
                        <div class="mdui-col-sm-3 mdui-text-right">
                            <!--constStr@EditTime--><i class="mdui-icon material-icons icon-sort" data-sort="date"
                                data-order="less">expand_less</i>
                        </div>
                        <div class="mdui-col-sm-2 mdui-text-right">
                            <!--constStr@Size--><i class="mdui-icon material-icons icon-sort" data-sort="size"
                                data-order="less">expand_less</i>
                        </div>
                    </div>
                </li>
                <!--BackArrowStart-->
                <li class="mdui-list-item mdui-ripple back-page">
                    <a href="<!--BackArrowUrl-->">
                        <div class="mdui-row mdui-col-sm-12">
                            <div class="mdui-col-xs-7">
                                <i class="mdui-icon material-icons">arrow_upward</i>
                            </div>
                            <div class="mdui-col-xs-3 mdui-text-right"></div>
                            <div class="mdui-col-xs-2 mdui-text-right"></div>
                        </div>
                    </a>
                </li>
                <!--BackArrowEnd-->
                <!--FolderListStart-->
                <li class="mdui-list-item mdui-ripple" data-sort data-sort-name="<!--FileEncodeReplaceName-->"
                    data-sort-date="<!--lastModifiedDateTime-->" data-sort-size="<!--size-->"
                    style="padding-right: 3.3rem">
                    <a href="<!--FileEncodeReplaceUrl-->/">
                        <div class="mdui-row mdui-col-sm-12">
                            <div class="mdui-col-xs-12 mdui-col-sm-7 mdui-text-truncate">
                                <i class="mdui-icon material-icons">folder_open</i><span>
                                    <!--FileEncodeReplaceName-->
                                </span>
                            </div>
                            <div class="mdui-col-sm-3 mdui-text-right">
                                <!--lastModifiedDateTime-->
                            </div>
                            <div class="mdui-col-sm-2 mdui-text-right">
                                <!--size-->
                            </div>
                        </div>
                    </a>
                </li>
                <!--FolderListEnd-->
                <!--FileListStart-->
                <li class="mdui-list-item file mdui-ripple" data-sort data-sort-name="<!--FileEncodeReplaceName-->"
                    data-sort-date="<!--lastModifiedDateTime-->" data-sort-size="<!--size-->"
                    data-readypreview="<!--FileExt-->">
                    <a class="<!--FileExtType-->" data-name="<!--FileEncodeReplaceName-->"
                        href="<!--FileEncodeReplaceUrl-->?preview" aria-label="File">
                        <div class="mdui-row mdui-col-sm-12">
                            <div class="mdui-col-xs-12 mdui-col-sm-7 mdui-text-truncate">

                                <i class="mdui-icon material-icons">
                                    <!--IconValue-->
                                </i>
                                <span>
                                    <!--FileEncodeReplaceName-->
                                </span>

                            </div>
                            <div class="mdui-col-sm-3 mdui-text-right">
                                <!--lastModifiedDateTime-->
                            </div>
                            <div class="mdui-col-sm-2 mdui-text-right">
                                <!--size-->
                            </div>
                        </div>
                    </a>
                    <div class="forcedownload mdui-text-right">
                        <a title="<!--constStr@Download-->" aria-label="Download" href="<!--FileEncodeReplaceUrl-->"
                            target="_blank"><button class="mdui-btn mdui-ripple mdui-btn-icon">
                                <i class="mdui-icon material-icons">file_download</i>
                            </button></a>
                    </div>
                </li>
                <!--FileListEnd-->
            </ul>
        </div>
        <!--ReadmemdStart-->
        <div class="mdui-chip mdui-ripple mdui-hidden-xs">
            <span class="mdui-chip-icon"><i class="mdui-icon material-icons">face</i></span><span
                class="mdui-chip-title">README.md</span>
        </div>
        <div class="mdui-typo mdui-shadow-3 markdown"
            style="padding: 20px; margin: 20px 0; overflow-x: scroll; background-color: rgb(22 22 22 / 43%);"
            id="readme">
            <textarea id="readme-md"><!--ReadmemdContent--></textarea>
        </div>
        <!--ReadmemdEnd-->
        <!--FootomfStart-->
        <div class="mdui-typo mdui-shadow-3" style="padding: 20px; margin: 20px 0">
            <!--FootomfContent-->
        </div>
        <!--FootomfEnd-->
        <script>
            document.querySelector("#admin-menu").innerHTML += '<li class="mdui-menu-item"><a class="mdui-ripple getalllink"><i class="mdui-menu-item-icon mdui-icon material-icons">link</i><!--constStr@CopyAllDownloadUrl--></a></li>';
        </script>
        <script>
            window.MorePage = undefined;
        </script>
        <!--MorePageStart-->
        <script>
            window.MorePage = [
        < !--MorePageListNowStart-->
          < !--PageNum-->,
        < !--MorePageListNowEnd-->
        < !--MorePageListStart-->
          < !--PageNum-->,
        < !--MorePageListEnd-->
        ];
        </script>
        <!--MorePageEnd-->
        <!--IsFolderEnd-->


        <!--IsFileStart-->
        <script>
            path = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));

            function copyURL() {
                copyText = document.createElement("input");
                copyText.id = "copyText";
                copyText.value = window.location.origin + path + "/" + "<!--FileDownUrl-->";
                p = document.querySelector('body');
                parent = p.parentNode;
                parent.appendChild(copyText);
                copyText.focus();
                copyText.select();
                document.execCommand("copy");
                document.getElementById("copyText").remove();
                mdui.snackbar("已複製到剪貼簿");
            }

            document.querySelector("#admin-menu").innerHTML += '<li class="mdui-menu-item"><a class="mdui-ripple" onclick="copyURL()"><i class="mdui-menu-item-icon mdui-icon material-icons">link</i><!--constStr@CopyUrl--></a></li>';

            document.querySelector(".mdui-toolbar").innerHTML += '<a class="mdui-btn mdui-btn-icon mdui-ripple downloadurl"><i class="mdui-icon material-icons">cloud_download</i></a>';
        </script>
        <div id="file" class="mdui-shadow-3" style="margin: 20px 0px; padding: 20px; border-radius: 8px">
            <!--IsimgFileStart-->
            <img class="mdui-img-fluid mdui-center" src="<!--FileDownUrl-->" />
            <!--IsimgFileEnd-->
            <!--IsmusicFileStart-->
            <div id="aplayer" class="mdui-text-center">音樂載入中...</div>
            <br />
            <div class="mdui-row" id="clpp">
                <a id="openiina" href="" type="button" class="clp mdui-btn mdui-ripple">IINA</a>
                <a id="openpot" href="" type="button" class="clp mdui-btn mdui-ripple">PotPlayer</a>
                <a id="openvlc" href="" type="button" class="clp mdui-btn mdui-ripple">VLC</a>
                <a id="opennp" href="" type="button" class="clp mdui-btn mdui-ripple">nPlayer</a>
                <a id="openmxfree" href="" type="button" class="clp mdui-btn mdui-ripple">MXPlayer</a>
                <a id="openmxpro" href="" type="button" class="clp mdui-btn mdui-ripple">MXPlayer Pro</a>
            </div>
            <script>
                document.getElementById("openiina").href = "iina://weblink?url=" + window.location.origin + path + "/" + "<!--FileDownUrl-->";
                document.getElementById("openpot").href = "potplayer://" + window.location.origin + path + "/" + "<!--FileDownUrl-->";
                document.getElementById("openvlc").href = "vlc://" + window.location.origin + path + "/" + "<!--FileDownUrl-->";
                document.getElementById("opennp").href = "nplayer-" + window.location.origin + path + "/" + "<!--FileDownUrl-->";
                document.getElementById("openmxfree").href = "intent:" + window.location.origin + path + "/" + "<!--FileDownUrl-->" + "#Intent;package=com.mxtech.videoplayer.ad;end";
                document.getElementById("openmxpro").href = "intent:" + window.location.origin + path + "/" + "<!--FileDownUrl-->" + "#Intent;package=com.mxtech.videoplayer.pro;end";

                ap = new APlayer({
                    container: document.getElementById('aplayer'),
                    theme: 'rgb(242, 200, 171)',
                    autoplay: false,
                    loop: 'all',
                    audio: [
                        {
                            name: "<!--FileDownUrl-->".substring(0, "<!--FileDownUrl-->".lastIndexOf('.')),
                            artist: "　",
                            url: "<!--FileDownUrl-->",
                            cover: "　"
                        }
                    ]
                });

                document.querySelector('.aplayer-author').innerHTML = "";

                isRecover = false;

                function AudioTime() {
                    if (!isRecover) {
                        if (ap.audio.duration > 0) {
                            if (localStorage.getItem(path + "/" + "<!--FileDownUrl-->") != null && localStorage.getItem(path + "/" + "<!--FileDownUrl-->") != 'null') {
                                ap.seek(localStorage.getItem(path + "/" + "<!--FileDownUrl-->") - 5);
                                mdui.snackbar('已恢復至上次播放位置');
                                isRecover = true;
                            } else {
                                isRecover = true;
                            }
                        }
                    } else {
                        if (ap.audio.currentTime >= 16 && ap.audio.currentTime <= ap.audio.duration - 16) {
                            localStorage.setItem(path + "/" + "<!--FileDownUrl-->", ap.audio.currentTime);
                        } else {
                            localStorage.setItem(path + "/" + "<!--FileDownUrl-->", null);
                        }
                    }
                }

                function AudioPause() {
                    if (window.location.href != oldURL) {
                        if (ap != undefined) {
                            ap.pause();
                        }
                        oldURL = window.location.href;
                    }
                }

                var oldURL = window.location.href;
                setInterval(AudioPause, 1000);
                setInterval(AudioTime, 1000);

                window.jsmediatags.read(window.location.origin + path + "/" + "<!--FileDownUrl-->", {
                    onSuccess: function (tag) {
                        if (tag.tags.picture != undefined) {
                            const data = tag.tags.picture.data;
                            const format = tag.tags.picture.format;
                            let base64String = "";
                            for (let i = 0; i < data.length; i++) {
                                base64String += String.fromCharCode(data[i]);
                            }
                            ap.options.audio[0].cover = `data:${format};base64,${window.btoa(base64String)}`;
                            document.querySelector('.aplayer-pic').style.backgroundImage = `url("data:${format};base64,${window.btoa(base64String)}")`;
                        }

                        if (tag.tags.title != undefined) {
                            ap.options.audio[0].name = tag.tags.title;
                            document.querySelector('.aplayer-title').innerHTML = tag.tags.title;
                        }

                        if (tag.tags.artist != undefined) {
                            ap.options.audio[0].artist = tag.tags.artist;
                            document.querySelector('.aplayer-author').innerHTML = " - " + tag.tags.artist;
                        }

                    },
                    onError: function (error) {
                        p = document.getElementById('aplayer');
                        parent = p.parentNode;
                        audio = document.createElement('audio');
                        audio.className = 'mdui-center';
                        audio.src = "<!--FileDownUrl-->";
                        audio.controls = true;
                        audio.autoplay = true;
                        audio.style = 'width: 100%';
                        parent.replaceChild(audio, p);
                    }
                });
            </script>
            <!--IsmusicFileEnd-->
            <!--IsvideoFileStart-->
            <div id="dplayer"></div>
            <br />
            <div class="mdui-row" id="clpp">
                <a id="openiina" href="" type="button" class="clp mdui-btn mdui-ripple">IINA</a>
                <a id="openpot" href="" type="button" class="clp mdui-btn mdui-ripple">PotPlayer</a>
                <a id="openvlc" href="" type="button" class="clp mdui-btn mdui-ripple">VLC</a>
                <a id="opennp" href="" type="button" class="clp mdui-btn mdui-ripple">nPlayer</a>
                <a id="openmxfree" href="" type="button" class="clp mdui-btn mdui-ripple">MXPlayer</a>
                <a id="openmxpro" href="" type="button" class="clp mdui-btn mdui-ripple">MXPlayer Pro</a>
            </div>
            <script>
                document.getElementById("openiina").href = "iina://weblink?url=" + window.location.origin + path + "/" + "<!--FileDownUrl-->";
                document.getElementById("openpot").href = "potplayer://" + window.location.origin + path + "/" + "<!--FileDownUrl-->";
                document.getElementById("openvlc").href = "vlc://" + window.location.origin + path + "/" + "<!--FileDownUrl-->";
                document.getElementById("opennp").href = "nplayer-" + window.location.origin + path + "/" + "<!--FileDownUrl-->";
                document.getElementById("openmxfree").href = "intent:" + window.location.origin + path + "/" + "<!--FileDownUrl-->" + "#Intent;package=com.mxtech.videoplayer.ad;end";
                document.getElementById("openmxpro").href = "intent:" + window.location.origin + path + "/" + "<!--FileDownUrl-->" + "#Intent;package=com.mxtech.videoplayer.pro;end";

                dp = new DPlayer({
                    container: document.getElementById('dplayer'),
                    theme: '#ffd2b3',
                    screenshot: true,
                    preload: 'auto',
                    playbackSpeed: [0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5, 5.5, 6],
                    video: {
                        url: "<!--FileDownUrl-->",
                        type: 'auto'
                    }
                });

                isRecover = false;

                function VideoTime() {
                    if (!isRecover) {
                        if (dp.video.duration > 0 && dp.video.duration != NaN) {
                            if (localStorage.getItem(path + "/" + "<!--FileDownUrl-->") != null && localStorage.getItem(path + "/" + "<!--FileDownUrl-->") != 'null') {
                                dp.seek(localStorage.getItem(path + "/" + "<!--FileDownUrl-->") - 5);
                                mdui.snackbar('已恢復至上次播放位置');
                                isRecover = true;
                            } else {
                                isRecover = true;
                            }
                        }
                    } else {
                        if (dp.video.currentTime >= 31 && dp.video.currentTime <= dp.video.duration - 31) {
                            localStorage.setItem(path + "/" + "<!--FileDownUrl-->", dp.video.currentTime);
                        } else {
                            localStorage.setItem(path + "/" + "<!--FileDownUrl-->", null);
                        }
                    }
                }

                setInterval(VideoTime, 1000);
            </script>
            <!--IsvideoFileEnd-->
            <!--IsofficeFileStart-->
            <iframe id="office-a" src="https://view.officeapps.live.com/op/view.aspx?src=<!--FileEncodeDownUrl-->"
                style="width: 100%" frameborder="0"></iframe>
            <script>
                window.onload = function () {
                    if (document.getElementById("office-a")) {
                        var ifm = document.getElementById("office-a");
                        var containerHeight = document.documentElement.clientHeight - 150;
                        ifm.height = containerHeight;
                    }
                }
                window.onresize = function () {
                    if (document.getElementById("office-a")) {
                        var ifm = document.getElementById("office-a");
                        var containerHeight = document.documentElement.clientHeight - 150;
                        ifm.height = containerHeight;
                    }
                }
            </script>
            <!--IsofficeFileEnd-->
            <!--IspdfFileStart-->
            <div id="pdf-d" style="text-align:center;margin:0 auto;width: calc(100%);">Loading PDF</div>
            <script>
                function renderpage(pdf, i) {
                    pdf.getPage(i).then(function (page) {
                        var scale = 1.5;
                        var viewport = page.getViewport({
                            scale: scale,
                        });
                        var canvas = document.getElementById("pdf-c" + i);
                        var context = canvas.getContext("2d");
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        canvas.style.width = "inherit";
                        var renderContext = {
                            canvasContext: context,
                            viewport: viewport,
                        };
                        page.render(renderContext);
                    });
                }

                function loadpdf() {
                    pdfjsLib.GlobalWorkerOptions.workerSrc =
                        "//unpkg.com/pdfjs-dist@2.5.207/es5/build/pdf.worker.js";
                    var loadingTask = pdfjsLib.getDocument({
                        url: "<!--FileDownUrl-->",
                        cMapUrl: "//unpkg.com/pdfjs-dist@2.5.207/cmaps/",
                        cMapPacked: true,
                        rangeChunkSize: 65535
                    });
                    loadingTask.promise.then(function (pdf) {
                        var pagenum = pdf.numPages;
                        var pdfContainer = document.getElementById("pdf-d");
                        pdfContainer.innerHTML = "";
                        for (var i = 1; i <= pagenum; i++) {
                            var canvasNew = document.createElement("canvas");
                            canvasNew.id = "pdf-c" + i;
                            pdfContainer.appendChild(canvasNew);
                            renderpage(pdf, i);
                        }
                    });
                }
                window.onload = function () {
                    if (document.getElementById("pdf-d")) {
                        loadpdf();
                    }
                }
            </script>
            <!--IspdfFileEnd-->
            <!--IstxtFileStart-->
            <pre id="editor"
                style="white-space: pre-wrap; font-family: JetBrains Mono, Fira Code, Sarasa Mono SC, Cascadia Code, Menlo, Consolas, monaco, Noto Sans SC;"><code id="code"><!--TxtContent--></code></pre>
            <script>
                document.querySelector("#admin-menu").innerHTML +=
                    '<li class="mdui-menu-item"><a class="mdui-ripple highlight"><i class="mdui-menu-item-icon mdui-icon material-icons">style</i>markdown解析</a></li>';
                document.querySelector(
                    ".mdui-toolbar"
                ).innerHTML +=
                    '<a class="mdui-btn mdui-btn-icon mdui-ripple mdui-hidden-sm-up highlight"><i class="mdui-icon material-icons">style</i></a>';
            </script>
            <!--IstxtFileEnd-->
            <!--IsOtherFileStart-->
            <!--constStr@FileNotSupport-->
            <!--IsOtherFileEnd-->
        </div>
        <a href="<!--FileEncodeReplaceUrl-->" target="_blank"
            class="mdui-fab mdui-fab-fixed mdui-ripple mdui-color-theme-accent"><i
                class="mdui-icon material-icons">file_download</i></a>
        <!--IsFileEnd-->
    </div>
    <div class="mdui-text-center mdui-typo" id="footer" style="position: relative;"></div>
</body>


<script src="//fastly.jsdelivr.net/npm/pdfjs-dist@2.5.207/es5/build/pdf.js"></script>
<script src="//fastly.jsdelivr.net/npm/mdui@1.0.1/dist/js/mdui.min.js"></script>
<script src="//fastly.jsdelivr.net/npm/sha-1@1.0.0/dist/sha1.umd.js"></script>
<script src="//fastly.jsdelivr.net/npm/jquery"></script>
<script src="//fastly.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>

<script src="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/js/extra.js"></script>

<script
    src="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/js/app@qm97ssij9cnii7x8fnbkpq4hcgq35dyr.js"></script>
<script
    src="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/js/app@59467336fgwnpx8qbfvtmpyeefv35e5i.js"></script>
<script
    src="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/js/app@a7r8jgn2qe3eyfrkahwdnqcjf7uba95k.js"></script>
<script
    src="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/js/app@keaxctnyw29nuzpsh66g7ki4h5wzy8zn.js"></script>
<script
    src="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/js/app@pe2nahunr9aihucdgc2ssjbgnaccr5rz.js"></script>
<script
    src="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/js/app@tsjmiafbhksy5pyb5tchy765wshmwwnd.js"></script>
<script
    src="//fastly.jsdelivr.net/npm/renexmoe-tw527e-edition@1.2.4/js/webpack-runtime@cx4vgpbaggjuhg8rh6m3yarhkkxy4dm3.js"></script>

<script>
    window.renexmoe.toggle_theme();
</script>

<!--customScript-->

<!--MdRequireStart--><link rel="stylesheet" href="https://unpkg.com/github-markdown-css@3.0.1/github-markdown.css">
<script type="text/javascript" src="?jsFile=marked.js"></script><!--MdRequireEnd-->
<!--ListStart-->
<!--GuestUploadStart--><script type="text/javascript" src="?jsFile=spark-md5.min.js"></script><!--GuestUploadEnd-->
<!--AliyundriveUploadJsStart--><script src="https://unpkg.com/bignumber.js@9.0.2/bignumber.js"></script>
<script src="?jsFile=sha1.min.js"></script><!--AliyundriveUploadJsEnd-->
<!--IsFileStart--><!--IspdfFileStart--><script src="https://unpkg.com/pdfjs-dist@2.4.456/build/pdf.min.js"></script><!--IspdfFileEnd--><!--IsFileEnd-->
<!--ListEnd-->
<script type="text/javascript">
    function changelanguage(str)
    {
        if (str=='Language') str = '';
        var expd = new Date();
        expd.setTime(expd.getTime()+(2*60*60*1000));
        var expires = "expires="+expd.toGMTString();
        document.cookie='language='+str+'; path=/; '+expires;
        location.href = location.href;
    }
<!--LoginStart-->
    function login() {
        document.getElementById('mask').style.display='';
            //document.getElementById('mask').style.width=document.documentElement.scrollWidth+'px';
        document.getElementById('mask').style.height=document.documentElement.scrollHeight<window.innerHeight?window.innerHeight:document.documentElement.scrollHeight+'px';
        document.getElementById('login_div').style.display='';
        document.getElementById('login_div').style.left=(document.body.clientWidth-document.getElementById('login_div').offsetWidth)/2 +'px';
        document.getElementById('login_div').style.top=(window.innerHeight-document.getElementById('login_div').offsetHeight)/2+document.body.scrollTop +'px';
        document.getElementById('login_input').focus();
    }
    function sha1loginpass(f) {
        if (f.password1.value=="") return false;
        try {
            timestamp = new Date().getTime() + "";
            timestamp = timestamp.substr(0, timestamp.length-3);
            f.timestamp.value = timestamp;
            f.password1.value = sha1(timestamp + "" + f.password1.value);
            return true;
        } catch {
            //alert("sha1.js not loaded.");
            if (confirm("sha1.js not loaded.\n\nLoad from program?")) loadjs("?jsFile=sha1.min.js");
            return false;
        }
    }
    function loadjs(url) {
        var xhr = new XMLHttpRequest;
        xhr.open("GET", url);
        xhr.onload = function(e) {
            if (xhr.status==200) {
                var script = document.createElement("script");
                script.type = "text/javascript";
                script.text = xhr.responseText;
                document.body.appendChild(script);
            } else {
                console.log(xhr.response);
            }
        }
        xhr.send(null);
    }
<!--LoginEnd-->
<!--WriteTimezoneStart-->
    var nowtime= new Date();
    var timezone = 0-nowtime.getTimezoneOffset()/60;
    var expd = new Date();
    expd.setTime(expd.getTime()+(2*60*60*1000));
    var expires = "expires="+expd.toGMTString();
    document.cookie="timezone="+timezone+"; path=/; "+expires;
    if (timezone!=<!--timezone-->) {
        //alert('Your timezone is '+timezone+', reload local timezone.');
        location.href=location.href;
    }
<!--WriteTimezoneEnd-->
<!--HeadmdStart-->
    var $head = document.getElementById('head');
    if ($head) {
        //document.getElementById('head-div').parentNode.insertBefore(document.getElementById('head-div'),document.getElementById('list-div'));
        $head.innerHTML = marked(document.getElementById('head-md').innerText);
    }
<!--HeadmdEnd-->
<!--ReadmemdStart-->
    var $readme = document.getElementById('readme');
    if ($readme) {
        $readme.innerHTML = marked(document.getElementById('readme-md').innerText);
    }
<!--ReadmemdEnd-->
<!--ListStart-->
<!--IsFileStart-->
    var $url = document.getElementById('url');
    if ($url) {
        //$url.innerHTML = location.protocol + '//' + location.host + $url.innerHTML;
        let url = location.href;
        url = url.substr(0, url.length-8);
        $url.innerHTML = url.replace(/&amp;/g, '&amp;amp;');
        $url.style.height = $url.scrollHeight + 'px';
    }
<!--IsofficeFileStart-->
    var $officearea=document.getElementById('office-a');
    if ($officearea) {
        $officearea.style.height = window.innerHeight + 'px';
    }
<!--IsofficeFileEnd-->
<!--IstxtFileStart-->
    var $textarea=document.getElementById('txt-a');
    if ($textarea) {
        $textarea.style.height = $textarea.scrollHeight + 'px';
    }
<!--IstxtFileEnd-->
<!--IsvideoFileStart-->
    function loadResources(type, src, callback) {
        let script = document.createElement(type);
        let loaded = false;
        if (typeof callback === 'function') {
            script.onload = script.onreadystatechange = () => {
                if (!loaded && (!script.readyState || /loaded|complete/.test(script.readyState))) {
                    script.onload = script.onreadystatechange = null;
                    loaded = true;
                    callback();
                }
            }
        }
        if (type === 'link') {
            script.href = src;
            script.rel = 'stylesheet';
        } else {
            script.src = src;
        }
        document.getElementsByTagName('head')[0].appendChild(script);
    }
    function addVideos(videos) {
        let host = 'https://s0.pstatp.com/cdn/expire-1-M';
        let unloadedResourceCount = 4;
        let callback = (() => {
            return () => {
                if (!--unloadedResourceCount) {
                    createDplayers(videos);
                }
            };
        })(unloadedResourceCount, videos);
        loadResources(
            'link',
            host + '/dplayer/1.25.0/DPlayer.min.css',
            callback
        );
        loadResources(
            'script',
            host + '/dplayer/1.25.0/DPlayer.min.js',
            callback
        );
        loadResources(
            'script',
            host + '/hls.js/0.12.4/hls.light.min.js',
            callback
        );
        loadResources(
            'script',
            host + '/flv.js/1.5.0/flv.min.js',
            callback
        );
    }
    function createDplayers(videos) {
        for (i = 0; i < videos.length; i++) {
            console.log(videos[i]);
            new DPlayer({
                container: document.getElementById('video-a' + i),
                screenshot: true,
                video: {
                    url: videos[i]
                }
            });
        }
    }
    addVideos(["<!--FileEncodeUrl-->"]);
<!--IsvideoFileEnd-->
<!--IspdfFileStart-->
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@2.4.456/build/pdf.worker.min.js';
    var loadingTask = pdfjsLib.getDocument({
        url: "<!--FileDownUrl-->",
        cMapUrl: "https://unpkg.com/pdfjs-dist@2.4.456/cmaps/",
        cMapPacked: true,
        disableStream: true,
        disableAutoFetch: true,
        rangeChunkSize: 65535
    });
    /*loadingTask.onProgress = (e) => {
        //console.log(e);
        var p = document.getElementById('p');
        if (p==null) {
            p = document.createElement('div');
            p.id = 'p';
            p.setAttribute('onclick', "this.style.display = 'none';");
            p.style = 'left: 10px; top: 30%; position: fixed;';
            document.body.appendChild(p);
        }
        p.innerHTML = 'Loaded: ' + ((e.loaded/e.total)*100).toFixed(2) + '%<br>(' + size_format(e.loaded) + ' / ' + size_format(e.total) + ')';
        p.style.display = '';
        if (e.loaded==e.total) p.style.display = 'none';
        
    }*/
    loadingTask.promise.then(function(pdf) {
        var pagenum =  pdf.numPages;
        var pdfContainer = document.getElementById('pdf-d');
        pdfContainer.innerHTML = '';
        var pagepos = 1;
        var pdfnextpagebutton = document.createElement('button');
        pdfnextpagebutton.id = 'pdfnextpagebutton';
        pdfnextpagebutton.innerText = 'Load page ' + pagepos + '-' + (pagepos+4<pagenum?pagepos+4:pagenum) + ' (' + pagenum + ')';
        pdfnextpagebutton.setAttribute('onclick', "this.style.display = 'none';");
        pdfnextpagebutton.style.display = 'none';
        pdfContainer.appendChild(pdfnextpagebutton);
        var pdfWaitNextPage = setInterval(function(){
            //console.log(document.documentElement.scrollTop + ", " + document.body.scrollHeight);
            if (pdfnextpagebutton.style.display=='none') {
                for (var i=pagepos;i<=(pagepos+4<pagenum?pagepos+4:pagenum);i++) {
                    var canvasNew = document.createElement('canvas');
                    canvasNew.id = 'pdf-c'+i;
                    pdfContainer.appendChild(canvasNew);
                    renderpage(pdf,i);
                }
                pagepos = i;
                if (pagepos<pagenum) {
                    console.log("next page: " + pagepos + " / " + pagenum);
                    pdfnextpagebutton.innerText = 'Load page ' + pagepos + '-' + (pagepos+4<pagenum?pagepos+4:pagenum) + ' (' + pagenum + ')';
                    pdfnextpagebutton.style.display ='';
                    pdfContainer.appendChild(pdfnextpagebutton);
                } else {
                    console.log("end of pdf");
                    clearInterval(pdfWaitNextPage);
                }
            }
        }, 1000);
    });
    function renderpage(pdf,i) {
        pdf.getPage(i).then(function(page) { 
            var scale = 1.5;
            var viewport = page.getViewport({ scale: scale, });
            var canvas = document.getElementById('pdf-c'+i);
            var context = canvas.getContext("2d");
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            var renderContext = {
                canvasContext: context,
                viewport: viewport,
            };
            page.render(renderContext);
        });
    }
    function size_format(num) {
        if (num>1024) {
            num=num/1024;
        } else {
            return num.toFixed(2) + ' B';
        }
        if (num>1024) {
            num=num/1024;
        } else {
            return num.toFixed(2) + ' KB';
        }
        if (num>1024) {
            num=num/1024;
        } else {
            return num.toFixed(2) + ' MB';
        }
        return num.toFixed(2) + ' GB';
    }
<!--IspdfFileEnd-->
<!--IsFileEnd-->
<!--IsFolderStart-->
<!--ShowThumbnailsStart-->
    function showthumbnails(obj) {
        images = [<!--ImgExts-->];
        var files=document.getElementsByName('filelist');
        for ($i=0;$i<files.length;$i++) {
            str=files[$i].innerText;
            if (str.substr(-1)==' ') str=str.substr(0,str.length-1);
            if (!str) continue;
            strarry=str.split('.');
            ext=strarry[strarry.length-1].toLowerCase();
            if (images.indexOf(ext)>-1) {
                var url=files[$i].href;
                url=url.substr(0,url.length-8);
                if (document.getElementById('originalpic').checked==true) {
                    files[$i].parentNode.parentNode.innerHTML='<td colspan="3"><img src="'+url+'" alt="'+str+'" onload="if (this.offsetWidth>document.getElementById(\'list-div\').offsetWidth) this.style.width=\'100%\';"></td>';
                    $i--;
                } else {
                    url+='?thumbnails';
                    get_thumbnails_url(url, str, files[$i]);
                }
            }
        }
        obj.disabled='disabled';
    }
    function get_thumbnails_url(url, name, filea) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.send('');
        xhr.onload = function(e){
            if (xhr.status==200) {
                if (xhr.responseText!='') filea.innerHTML='<img src="'+xhr.responseText+'" alt="'+name+'">';
            } else console.log(xhr.status+'\n'+xhr.responseText);
        }
    }
<!--ShowThumbnailsEnd-->
<!--MorePageStart-->
    function nextpage(num) {
        document.getElementById('pagenum').value=num;
        document.getElementById('nextpageform').submit();
    }
<!--MorePageEnd-->
<!--IsNotHiddenStart-->
    var sort=0;
    function sortby(string) {
        if (string=='a') if (sort!=0) {
            for (i = 1; i <= <!--maxfilenum-->; i++) document.getElementById('tr'+i).parentNode.insertBefore(document.getElementById('tr'+i),document.getElementById('tr'+(i-1)).nextSibling);
            sort=0;
            return;
        } else return;
        sort1=sort;
        sortby('a');
        sort=sort1;
        var a=[];
        for (i = 1; i <= <!--maxfilenum-->; i++) {
            a[i]=i;
            if (!!document.getElementById('folder_'+string+i)) {
                var td1=document.getElementById('folder_'+string+i);
                for (j = 1; j < i; j++) {
                    if (!!document.getElementById('folder_'+string+a[j])) {
                        var c=false;
                        if (string=='time') if (sort==-1) {
                            c=(td1.innerText < document.getElementById('folder_'+string+a[j]).innerText);
                        } else {
                            c=(td1.innerText > document.getElementById('folder_'+string+a[j]).innerText);
                        }
                        if (string=='size') if (sort==2) {
                            c=(size_reformat(td1.innerText) < size_reformat(document.getElementById('folder_'+string+a[j]).innerText));
                        } else {
                            c=(size_reformat(td1.innerText) > size_reformat(document.getElementById('folder_'+string+a[j]).innerText));
                        }
                        if (c) {
                            document.getElementById('tr'+i).parentNode.insertBefore(document.getElementById('tr'+i),document.getElementById('tr'+a[j]));
                            for (k = i; k > j; k--) {
                                a[k]=a[k-1];
                            }
                            a[j]=i;
                            break;
                        }
                    }
                }
            }
            if (!!document.getElementById('file_'+string+i)) {
                var td1=document.getElementById('file_'+string+i);
                for (j = 1; j < i; j++) {
                    if (!!document.getElementById('file_'+string+a[j])) {
                        var c=false;
                        if (string=='time') if (sort==-1) {
                            c=(td1.innerText < document.getElementById('file_'+string+a[j]).innerText);
                        } else {
                            c=(td1.innerText > document.getElementById('file_'+string+a[j]).innerText);
                        }
                        if (string=='size') if (sort==2) {
                            c=(size_reformat(td1.innerText) < size_reformat(document.getElementById('file_'+string+a[j]).innerText));
                        } else {
                            c=(size_reformat(td1.innerText) > size_reformat(document.getElementById('file_'+string+a[j]).innerText));
                        }
                        if (c) {
                            document.getElementById('tr'+i).parentNode.insertBefore(document.getElementById('tr'+i),document.getElementById('tr'+a[j]));
                            for (k = i; k > j; k--) {
                                a[k]=a[k-1];
                            }
                            a[j]=i;
                            break;
                        }
                    }
                }
            }
        }
        if (string=='time') if (sort==-1) {
            sort=1;
        } else {
            sort=-1;
        }
        if (string=='size') if (sort==2) {
            sort=-2;
        } else {
            sort=2;
        }
    }
    function size_reformat(str) {
        if (str.substr(-1)==' ') str=str.substr(0,str.length-1);
        if (str.substr(-2)=='TB') num=str.substr(0,str.length-3)*1024*1024*1024*1024;
        if (str.substr(-2)=='GB') num=str.substr(0,str.length-3)*1024*1024*1024;
        if (str.substr(-2)=='MB') num=str.substr(0,str.length-3)*1024*1024;
        if (str.substr(-2)=='KB') num=str.substr(0,str.length-3)*1024;
        if (str.substr(-2)==' B') num=str.substr(0,str.length-2);
        return num;
    }
<!--IsNotHiddenEnd-->
<!--IsFolderEnd-->
    function CopyAllDownloadUrl(str) {
        var tmptextarea=document.createElement('textarea');
        document.body.appendChild(tmptextarea);
        tmptextarea.setAttribute('style','position:absolute;left:-100px;width:0px;height:0px;');
        document.querySelectorAll(str).forEach(function (e) {
            tmptextarea.innerHTML+=e.href+"\r\n";
        });
        tmptextarea.select();
        tmptextarea.setSelectionRange(0, tmptextarea.value.length);
        document.execCommand("copy");
        alert(tmptextarea.innerHTML+"<!--constStr@Success-->");
    }
<!--UploadJsStart-->
    function size_format(num) {
        if (num>1024) {
            num=num/1024;
        } else {
            return num.toFixed(2) + ' B';
        }
        if (num>1024) {
            num=num/1024;
        } else {
            return num.toFixed(2) + ' KB';
        }
        if (num>1024) {
            num=num/1024;
        } else {
            return num.toFixed(2) + ' MB';
        }
        return num.toFixed(2) + ' GB';
    }
    function seconds2hour(seconds) {
        let h, m, s;
        if (parseFloat(seconds)<60) {
            return seconds + 's';
        } else {
            s = (seconds % 60).toFixed(0);
            m = parseInt(seconds / 60);
            if (parseInt(m)<60) {
                return m + 'm' + s + 's';
            } else {
                h = parseInt(m / 60);
                m = m % 60;
                return h + 'h' + m + 'm' + s + 's';
            }
        }
    }
    function uploadbuttonhide() {
        document.getElementById('upload_btns').style.display='none';
        /*document.getElementById('upload_submit').disabled='disabled';
        document.getElementById('upload_file').disabled='disabled';
        document.getElementById('upload_submit').style.display='none';
        document.getElementById('upload_file').style.display='none';*/
    }
    function uploadbuttonshow() {
        document.getElementById('upload_btns').style.display='';
        /*document.getElementById('upload_file').disabled='';
        document.getElementById('upload_submit').disabled='';
        document.getElementById('upload_submit').style.display='';
        document.getElementById('upload_file').style.display='';*/
    }
    var uploading = new Object();
<!--UploadJsEnd-->
<!--OnedriveUploadJsStart-->
    function preup() {
        uploadbuttonhide();
        var files=document.getElementById('upload_file').files;
	    if (files.length<1) {
            uploadbuttonshow();
            return;
        };
        var table1=document.createElement('table');
        document.getElementById('upload_div').appendChild(table1);
        table1.setAttribute('class','list-table');
        var timea=new Date().getTime();
        var i=0;
        var uploadList = setInterval(function(){
            if (i<files.length) {
                if (Object.keys(uploading).length<5) {
                    getuplink(i);
                    i++;
                }// else console.log(Object.keys(uploading).length);
            } else clearInterval(uploadList);
        }, 1000);
        //getuplink(i);
        function getuplink(i, r=0) {
            var file=files[i];
            var td1;
            var td2;
            if (r==0) {
                var tr1=document.createElement('tr');
                table1.appendChild(tr1);
                tr1.setAttribute('data-to',1);
                td1=document.createElement('td');
                tr1.appendChild(td1);
                td1.setAttribute('style','width:30%;word-break:break-word;');
                td1.setAttribute('id','upfile_td1_'+timea+'_'+i);
                td1.innerHTML=(file.webkitRelativePath||file.name)+'<br>'+size_format(file.size)+' ('+(i+1)+'/'+files.length+')';
                td2=document.createElement('td');
                tr1.appendChild(td2);
                td2.setAttribute('id','upfile_td2_'+timea+'_'+i);
            }
            var tdnum = timea+'_'+i;
            td1=document.getElementById('upfile_td1_'+tdnum);
            td2=document.getElementById('upfile_td2_'+tdnum);
            if (file.size>100*1024*1024*1024) {
                td2.innerHTML='<font color="red"><!--constStr@UpFileTooLarge--></font>';
                uploadbuttonshow();
                return;
            }
            var upbigfilename = encodeURIComponent((file.webkitRelativePath||file.name));
            uploading[upbigfilename] = i;
            var filemd5='';
<!--GuestStart-->
            function getext(str) {
                strarry=str.split('.');
                if (strarry.length==1) return '';
                ext=strarry[strarry.length-1].toLowerCase();
                var reg = new RegExp(".","g");
                var a = str.replace(reg,"");
                if (a == ext) ext = "";
                else ext = "." + ext;
                return ext;
            }
        var ext = getext(file.webkitRelativePath||file.name);
        var spark = new SparkMD5.ArrayBuffer();
        var reader = new FileReader();
        var chunksize=10*1024*1024;
        var asize = 0;
        function readblob(start) {
            var end=start+chunksize;
            var blob = file.slice(start,end);
            reader.readAsArrayBuffer(blob);
        }
        readblob(asize);

        reader.onload = function(e){
            td2.innerHTML='<!--constStr@Calculate--> md5: '+(asize*100/file.size).toFixed(2)+'%';
            var binary = this.result;
            spark.append(binary);
            asize += chunksize;
            if (asize < file.size) {
                readblob(asize);
            } else {
                filemd5 = spark.end();
                td2.innerHTML='md5: '+filemd5;
                delete uploading[upbigfilename];
                upbigfilename = encodeURIComponent((file.webkitRelativePath||file.name));
                uploading[upbigfilename] = i;
<!--GuestEnd-->
            td2.innerHTML='<!--constStr@GetUploadLink--> ...';
            var xhr1 = new XMLHttpRequest();
            xhr1.open("POST", '?action=upbigfile');
            //xhr1.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8");
            xhr1.setRequestHeader('x-requested-with','XMLHttpRequest');
            xhr1.onprogress = function(e){
                td2.innerHTML+='.';
            }
            xhr1.onload = function(e){
                //console.log(xhr1.status+xhr1.responseText);
                td2.innerHTML='<font color="red">'+xhr1.responseText+'</font>';
                if (xhr1.status==200) {
                    if (xhr1.responseText=='') {
                        getuplink(i,1);
                        return;
                    }
                    var html=JSON.parse(xhr1.responseText);
                    if (!html['uploadUrl']) {
                        td2.innerHTML='<font color="red">'+xhr1.responseText+'</font><br>';
                    } else {
                        td2.innerHTML='<!--constStr@UploadStart--> ...';
                        binupfile(file,html['uploadUrl'],timea+'_'+i, upbigfilename);
                    }
                } else {
                    if (xhr1.status==409) {
                        // td2.innerHTML='nameAlreadyExists';
                        var html=JSON.parse(xhr1.responseText);
                        td2.innerHTML=html['error']['code']+': '+html['error']['message'];
<!--GuestStart-->
                        td2.innerHTML='md5: '+filemd5;
                        td1.innerHTML='<div style="color:green"><a href="<!--base_disk_path--><!--Path-->'+upbigfilename+'?preview" id="upfile_a_'+tdnum+'" target="_blank">'+td1.innerHTML+'</a><br><a href="<!--base_disk_path--><!--Path-->'+upbigfilename+'" id="upfile_a1_'+tdnum+'"></a><!--constStr@UploadComplete--><button onclick="CopyAllDownloadUrl(\'#upfile_a1_'+tdnum+'\');" id="upfile_cpbt_'+tdnum+'"><!--constStr@CopyUrl--></button></div>';
<!--GuestEnd-->
<!--AdminStart-->
                        td1.innerHTML='<div style="color:green"><a href="<!--base_disk_path--><!--Path-->'+(file.webkitRelativePath||file.name)+'?preview" id="upfile_a_'+tdnum+'" target="_blank">'+td1.innerHTML+'</a><br><a href="<!--base_disk_path--><!--Path-->'+(file.webkitRelativePath||file.name)+'" id="upfile_a1_'+tdnum+'"></a><!--constStr@UploadComplete--><button onclick="CopyAllDownloadUrl(\'#upfile_a1_'+tdnum+'\');" id="upfile_cpbt_'+tdnum+'" style="display:none"><!--constStr@CopyUrl--></button></div>';
<!--AdminEnd-->
                    }
                /*if (i<files.length-1) {
                    i++;
                    getuplink(i);
                }*/
                    delete uploading[upbigfilename];
                }
            }
            xhr1.send('upbigfilename='+ upbigfilename +'&filesize='+ file.size +'&filelastModified='+ file.lastModified +'&filemd5='+ filemd5 + '&_admin=' + localStorage.getItem("admin"));
<!--GuestStart-->
            }
        }
<!--GuestEnd-->
        }
        uploadbuttonshow();
    }

    function binupfile(file,url,tdnum,filename){
        var label=document.getElementById('upfile_td2_'+tdnum);
        var reader = new FileReader();
        var StartStr='';
        var MiddleStr='';
        var StartTime;
        var EndTime;
        var newstartsize = 0;
        if(!!file){
            var asize=0;
            var chunksize=10*1024*1024; // chunk size, max 60M. 每小块上传大小，最大60M，微软建议10M
            var totalsize=file.size;
            var xhr2 = new XMLHttpRequest();
            xhr2.open("GET", url);
                    //xhr2.setRequestHeader('x-requested-with','XMLHttpRequest');
            xhr2.send(null);
            xhr2.onload = function(e){
                if (xhr2.status==200) {
                    var html = JSON.parse(xhr2.responseText);
                    var a = html['nextExpectedRanges'][0];
                    newstartsize = Number( a.slice(0,a.indexOf("-")) );
                    StartTime = new Date();
                    asize = newstartsize;
                    if (newstartsize==0) {
                        StartStr='<!--constStr@UploadStartAt-->:' +StartTime.toLocaleString()+'<br>' ;
                    } else {
                        StartStr='<!--constStr@LastUpload-->'+size_format(newstartsize)+ '<br><!--constStr@ThisTime--><!--constStr@UploadStartAt-->:' +StartTime.toLocaleString()+'<br>' ;
                    }
                    function readblob(start) {
                        var end=start+chunksize;
                        var blob = file.slice(start,end);
                        reader.readAsArrayBuffer(blob);
                    }
                    readblob(asize);

                    reader.onload = function(e){
                        var binary = this.result;
                        var lastCurrentSpeed;
                        var xhr = new XMLHttpRequest();
                        xhr.open("PUT", url, true);
                        //xhr.setRequestHeader('x-requested-with','XMLHttpRequest');
                        bsize=asize+e.loaded-1;
                        xhr.setRequestHeader('Content-Range', 'bytes ' + asize + '-' + bsize +'/'+ totalsize);
                        xhr.upload.onprogress = function(e){
                            if (e.lengthComputable) {
                                let tmptime = new Date();
                                let tmpspeed = e.loaded*1000/(tmptime.getTime()-C_starttime.getTime());
                                lastCurrentSpeed = tmpspeed;
                                let remaintime = (totalsize-asize-e.loaded)/tmpspeed;
                                let percent = ((asize+e.loaded)*100/totalsize).toFixed(2);
                                label.parentNode.style.background = "linear-gradient(to right, rgba(0,0,0,25%) " + percent + "%, rgba(0,0,0,0%) 0%)";
                                label.innerHTML = StartStr+'<!--constStr@Upload--> ' +size_format(asize+e.loaded)+ ' / '+size_format(totalsize) + ' = ' + percent + '% <!--constStr@AverageSpeed-->:'+size_format((asize+e.loaded-newstartsize)*1000/(tmptime.getTime()-StartTime.getTime()))+'/s<br><!--constStr@CurrentSpeed--> '+size_format(tmpspeed)+'/s <!--constStr@Expect--> '+seconds2hour(remaintime.toFixed(1));
                            }
                        }
                        var C_starttime = new Date();
                        xhr.onload = function(e){
                            if (xhr.status<500) {
                            var response=JSON.parse(xhr.responseText);
                            if (response['size']>0) {
                                // contain size, upload finish. 有size说明是最终返回，上传结束
                                if (totalsize>10*1024*1024) {
                                    var xhr3 = new XMLHttpRequest();
                                    xhr3.open("GET", '?action=del_upload_cache&filelastModified='+file.lastModified+'&filesize='+file.size+'&filename='+filename);
                                    xhr3.setRequestHeader('x-requested-with','XMLHttpRequest');
                                    xhr3.send(null);
                                    xhr3.onload = function(e){
                                        console.log(xhr3.responseText+','+xhr3.status);
                                    }
                                }
                                EndTime=new Date();
                                MiddleStr = '<!--constStr@EndAt-->:'+EndTime.toLocaleString()+'<br>';
                                if (newstartsize==0) {
                                    MiddleStr += '<!--constStr@AverageSpeed-->:'+size_format(totalsize*1000/(EndTime.getTime()-StartTime.getTime()))+'/s<br>';
                                } else {
                                    MiddleStr += '<!--constStr@ThisTime--><!--constStr@AverageSpeed-->:'+size_format((totalsize-newstartsize)*1000/(EndTime.getTime()-StartTime.getTime()))+'/s<br>';
                                }
                                delete uploading[filename];
                                while (filename.indexOf('%2F')>0) filename = filename.replace('%2F', '/');
                                document.getElementById('upfile_td1_'+tdnum).innerHTML='<div style="color:green"><a href="<!--base_disk_path--><!--Path-->'+filename+'?preview" id="upfile_a_'+tdnum+'" target="_blank">'+document.getElementById('upfile_td1_'+tdnum).innerHTML+'</a><br><a href="<!--base_disk_path--><!--Path-->'+filename+'" id="upfile_a1_'+tdnum+'"></a><!--constStr@UploadComplete--><button onclick="CopyAllDownloadUrl(\'#upfile_a1_'+tdnum+'\');" id="upfile_cpbt_'+tdnum+'" <!--AdminStart--> style="display:none"<!--AdminEnd--> ><!--constStr@CopyUrl--></button></div>';
                                label.innerHTML=StartStr+MiddleStr;
                                label.parentNode.style.background = 'rgba(0,80,0,25%)';
                                
                                // uploadbuttonshow();
<!--AdminStart-->
                                response.name=file.webkitRelativePath||response.name;
                                addelement(response);
<!--AdminEnd-->
                            } else {
                                if (!response['nextExpectedRanges']) {
                                    label.innerHTML='<font color="red">'+xhr.responseText+'</font><br>';
                                    delete uploading[filename];
                                } else {
                                    var a=response['nextExpectedRanges'][0];
                                    asize=Number( a.slice(0,a.indexOf("-")) );
                                    chunksize = 10*1024*1024;
                                    if (lastCurrentSpeed>5*1024*1024) chunksize = 20*1024*1024;
                                    if (lastCurrentSpeed>10*1024*1024) chunksize = 50*1024*1024;
                                    readblob(asize);
                                }
                            } } else readblob(asize);
                        }
                        xhr.send(binary);
                    }
                } else {
                    if (window.location.pathname.indexOf('%23')>0||filename.indexOf('%23')>0) {
                        label.innerHTML='<font color="red"><!--constStr@UploadFail23--></font>';
                    } else {
                        label.innerHTML='<font color="red">'+xhr2.responseText+'</font>';
                    }
                    delete uploading[filename];
                    // uploadbuttonshow();
                }
            }
        }
    }
<!--OnedriveUploadJsEnd-->
<!--AliyundriveUploadJsStart-->
    function preup() {
        uploadbuttonhide();
        var files=document.getElementById('upload_file').files;
	    if (files.length<1) {
            uploadbuttonshow();
            return;
        };
        var table1=document.createElement('table');
        document.getElementById('upload_div').appendChild(table1);
        table1.setAttribute('class','list-table');
        var timea=new Date().getTime();
        var i=0;
        var uploadList = setInterval(function(){
            if (i<files.length) {
                if (Object.keys(uploading).length<5) {
                    getuplink(i);
                    i++;
                }// else console.log(Object.keys(uploading).length);
            } else clearInterval(uploadList);
        }, 1000);
        function CalcProof(file) {
            return new Promise(function(resolve, reject){
                var xhr = new XMLHttpRequest();
                xhr.open("POST", '?action=upbigfile');
                xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8");
                xhr.setRequestHeader('x-requested-with', 'XMLHttpRequest');
                xhr.onload = function(e){
                    var html;
                    if (xhr.status==200) {
                        //console.log(xhr.responseText);
                        var r = new BigNumber("0x".concat(xhr.responseText));
                        var i = new BigNumber(file.size);
                        var o = i ? r.mod(i) : 0;
                        var reader1 = new FileReader();
                        var start = o.toNumber();
                        var end = start + 8;
                        //if (file.size<end) end = file.size;
                        console.log(start + " ~ " + end);
                        //reader1.readAsBinaryString(file.slice(start,end));
                        reader1.readAsDataURL(file.slice(start,end));
                        reader1.onload = function(e) {
                            var proof = this.result;
                            proof = proof.substr(proof.indexOf('base64,')+7);
                            resolve(proof);
                        }
                    } else {
                        //console.log(xhr.status+'calc proof code\n'+xhr.responseText);
                        reject(xhr.status+"\ncalc proof code\n"+xhr.responseText);
                    }
                }
                xhr.send('CalcProof=1');
            });
        }
        function getuplink(i, r=0) {
            var file=files[i];
            var td1;
            var td2;
            if (r==0) {
                var tr1=document.createElement('tr');
                table1.appendChild(tr1);
                tr1.setAttribute('data-to',1);
                td1=document.createElement('td');
                tr1.appendChild(td1);
                td1.setAttribute('style','width:30%;word-break:break-word;');
                td1.setAttribute('id','upfile_td1_'+timea+'_'+i);
                td1.innerHTML=(file.webkitRelativePath||file.name)+'<br>'+size_format(file.size)+' ('+(i+1)+'/'+files.length+')';
                td2=document.createElement('td');
                tr1.appendChild(td2);
                td2.setAttribute('id','upfile_td2_'+timea+'_'+i);
            }
            var tdnum = timea+'_'+i;
            td1=document.getElementById('upfile_td1_'+tdnum);
            td2=document.getElementById('upfile_td2_'+tdnum);
            var chunksize=10*1024*1024; // 分块大小
            //var chunksize=100*1024; // 测试小块
            /*if (file.size>100*1024*1024*1024) {
                td2.innerHTML='<font color="red"><!--constStr@UpFileTooLarge--></font>';
                uploadbuttonshow();
                return;
            }*/
            
            var upbigfilename = encodeURIComponent((file.webkitRelativePath||file.name));
            uploading[upbigfilename] = [i];
            var spark = sha1.create();
            var reader = new FileReader();
            var asize = 0;
            var filesha1;
            function readblob(start) {
                var end=start+chunksize;
                var blob = file.slice(start,end);
                reader.readAsArrayBuffer(blob);
            }
            var proof_code = '';
            CalcProof(file).then(a => {
                proof_code = a;
                console.log('proof: ' + proof_code);
                readblob(asize);
            }, e => {
                td2.innerHTML = e;
            });

            reader.onload = function(e){
                td2.innerHTML='<!--constStr@Calculate--> SHA1: '+(asize*100/file.size).toFixed(2)+'%';
                var binary = this.result;
                spark.update(binary);
                asize += chunksize;
                if (asize < file.size) {
                    readblob(asize);
                } else {
                    filesha1 = spark.hex();
                    td2.innerHTML='SHA1: ' + filesha1;
<!--GuestStart-->
                    function getext(str) {
                        let p = str.lastIndexOf('.');
                        if (p===-1) return '';
                        if (p===0) return '';
                        return str.substr(p);
                    }
                    var ext = getext(file.webkitRelativePath||file.name);
                    upbigfilename = filesha1 + ext;
<!--GuestEnd-->
                    //while (upbigfilename.indexOf('%2F')>0) upbigfilename = upbigfilename.replace('%2F', '/');
                    td2.innerHTML='<!--constStr@GetUploadLink--> ...';
                    var html = JSON.parse(localStorage.getItem(filesha1));
                    //console.log(html);
                    if (html!==null && ('part_info_list' in html)) {
                        td2.innerHTML='<!--constStr@UploadStart--> ...';
                        binupfile(file, html, timea+'_'+i, upbigfilename, filesha1, chunksize);
                    } else {
                        var xhr1 = new XMLHttpRequest();
                        xhr1.open("POST", '?action=upbigfile');
                        //xhr1.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8");
                        xhr1.setRequestHeader('x-requested-with','XMLHttpRequest');
                        xhr1.onload = function(e){
                            //console.log(xhr1.status+xhr1.responseText);
                            td2.innerHTML='<font color="red">'+xhr1.responseText+'</font>';
                            if (xhr1.status==201) {
                                if (xhr1.responseText=='') {
                                    getuplink(i,1);
                                    return;
                                }
                                var html=JSON.parse(xhr1.responseText);
                                //console.log(html);
                                if (!html['part_info_list']) {
                                    if (html.name!='') {
                                        if (html.exist==true) td2.innerHTML=html.name+' 文件名已有';
                                        else if (html.rapid_upload==true) td2.innerHTML=html.name+' 秒传';
                                        else td2.innerHTML='<font color="red">'+xhr1.responseText+'</font><br>';
                                        td1.innerHTML='<div style="color:green"><a href="<!--base_disk_path--><!--Path-->'+upbigfilename+'?preview" id="upfile_a_'+tdnum+'" target="_blank">'+td1.innerHTML+'</a><br><a href="<!--base_disk_path--><!--Path-->'+upbigfilename+'" id="upfile_a1_'+tdnum+'"></a><!--constStr@UploadComplete--><button onclick="CopyAllDownloadUrl(\'#upfile_a1_'+tdnum+'\');" id="upfile_cpbt_'+tdnum+'" <!--AdminStart--> style="display:none"<!--AdminEnd--> ><!--constStr@CopyUrl--></button></div>';
                                    } else {
                                        td2.innerHTML='<font color="red">'+xhr1.responseText+'</font><br>';
                                    }
                                    delete uploading[upbigfilename];
                                } else {
                                    td2.innerHTML='<!--constStr@UploadStart--> ...';
                                    //console.log(html);
                                    localStorage.setItem(filesha1, JSON.stringify(html));
                                    binupfile(file, html, timea+'_'+i, upbigfilename, filesha1, chunksize);
                                }
                            } else {
                                delete uploading[upbigfilename];
                            }
                            /*if (i<files.length-1) {
                                i++;
                                getuplink(i);
                            }*/
                        }
                        xhr1.send('upbigfilename='+ upbigfilename +'&filesize='+ file.size +'&filelastModified='+ file.lastModified + '&proof_code=' + proof_code + '&filesha1=' + filesha1 + '&chunksize=' + chunksize + '&_admin=' + localStorage.getItem("admin"));
                    }
                }
            }
        }
        uploadbuttonshow();
    }
    function binupfile(file, res, tdnum, filename, filesha1, chunksize) {
        // xhr.getResponseHeader
        if (!('ETag' in res)) res['ETag'] = new Array();
        var fileid = res['file_id'];
        var uploadid = res['upload_id'];
        var label=document.getElementById('upfile_td2_'+tdnum);
        var reader = new FileReader();
        var StartStr='';
        var MiddleStr='';
        var StartTime;
        var EndTime;
        var newstartsize = 0;
        if(!!file){
            var chunknum = 0;
            var chunknumtotal = res['part_info_list'].length;
            var asize=0;
            var totalsize=file.size;
            var newstartsize=0;
            while (res['ETag'][chunknum]!=null) {
                chunknum++;
                newstartsize += chunksize;
            }
            StartTime = new Date();
            asize = newstartsize;
            if (newstartsize==0) {
                StartStr='<!--constStr@UploadStartAt-->:' +StartTime.toLocaleString()+'<br>' ;
            } else {
                StartStr='<!--constStr@LastUpload-->'+size_format(newstartsize)+ '<br><!--constStr@ThisTime--><!--constStr@UploadStartAt-->:' +StartTime.toLocaleString()+'<br>' ;
            }
            //var chunksize=5*1024*1024; // chunk size, max 60M. 每小块上传大小
            //if (totalsize>200*1024*1024) chunksize=10*1024*1024;
            function readblob(start) {
                var end=start+chunksize;
                var blob = file.slice(start,end);
                reader.readAsArrayBuffer(blob);
                //reader.readAsArrayBuffer(file);
            }
            readblob(asize);

            reader.onload = function(e){
                if (asize>totalsize) {
                    var xhr1 = new XMLHttpRequest();
                    xhr1.open("POST", '?action=upbigfile');
                    //xhr1.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8");
                    xhr1.setRequestHeader('x-requested-with','XMLHttpRequest');
                    xhr1.onload = function(e){
                        console.log(xhr1.responseText+','+xhr1.status);
                        if (xhr1.status==200) {
                            localStorage.removeItem(filesha1);
<!--AdminStart-->
                            var html=JSON.parse(xhr1.responseText);
                            //response.name=file.webkitRelativePath||response.name;
                            addelement(html);
<!--AdminEnd-->
                            /*if (totalsize>10*1024*1024) {
                                var xhr3 = new XMLHttpRequest();
                                xhr3.open("GET", '?action=del_upload_cache&filelastModified='+file.lastModified+'&filesize='+file.size+'&filename='+filename);
                                xhr3.setRequestHeader('x-requested-with','XMLHttpRequest');
                                xhr3.send(null);
                                xhr3.onload = function(e){
                                    console.log(xhr3.responseText+','+xhr3.status);
                                }
                            }*/
                            EndTime=new Date();
                            MiddleStr = '<!--constStr@EndAt-->:'+EndTime.toLocaleString()+'<br>';
                            if (newstartsize==0) {
                                MiddleStr += '<!--constStr@AverageSpeed-->:'+size_format(totalsize*1000/(EndTime.getTime()-StartTime.getTime()))+'/s<br>';
                            } else {
                                MiddleStr += '<!--constStr@ThisTime--><!--constStr@AverageSpeed-->:'+size_format((totalsize-newstartsize)*1000/(EndTime.getTime()-StartTime.getTime()))+'/s<br>';
                            }
                            document.getElementById('upfile_td1_'+tdnum).innerHTML='<div style="color:green"><a href="<!--base_disk_path--><!--Path-->'+filename+'?preview" id="upfile_a_'+tdnum+'" target="_blank">'+document.getElementById('upfile_td1_'+tdnum).innerHTML+'</a><br><a href="<!--base_disk_path--><!--Path-->'+filename+'" id="upfile_a1_'+tdnum+'"></a><!--constStr@UploadComplete--><button onclick="CopyAllDownloadUrl(\'#upfile_a1_'+tdnum+'\');" id="upfile_cpbt_'+tdnum+'" <!--AdminStart--> style="display:none"<!--AdminEnd--> ><!--constStr@CopyUrl--></button></div>';
                            label.innerHTML=StartStr+MiddleStr;
                            label.parentNode.style.background = 'rgba(0,80,0,25%)';
                        } else {
                            label.innerHTML= '<font color="red">' + xhr1.status + ',' + xhr1.responseText + '</font>';
                            localStorage.removeItem(filesha1);
                        }
                        delete uploading[filename];
                    }
                    xhr1.send('uploadid=' + uploadid + '&fileid=' + fileid + '&etag=' + JSON.stringify(res['ETag']) + '&_admin=' + localStorage.getItem("admin"));
                } else {
                    var binary = this.result;
                    var xhr = new XMLHttpRequest();
                    xhr.open("PUT", res['part_info_list'][chunknum]['upload_url'], true);
                    //xhr.setRequestHeader('x-requested-with','XMLHttpRequest');
                    bsize=asize+e.loaded-1;
                    xhr.setRequestHeader('Content-Range', 'bytes ' + asize + '-' + bsize +'/'+ totalsize);
                    xhr.upload.onprogress = function(e){
                        if (e.lengthComputable) {
                            var tmptime = new Date();
                            var tmpspeed = e.loaded*1000/(tmptime.getTime()-C_starttime.getTime());
                            var remaintime = (totalsize-asize-e.loaded)/tmpspeed;
                            let percent = ((asize+e.loaded)*100/totalsize).toFixed(2);
                            label.parentNode.style.background = "linear-gradient(to right, rgba(0,0,0,25%) " + percent + "%, rgba(0,0,0,0%) 0%)";
                            label.innerHTML=StartStr+'<!--constStr@Upload--> ' +size_format(asize+e.loaded)+ ' / '+size_format(totalsize) + ' = ' + percent + '% <!--constStr@AverageSpeed-->:'+size_format((asize+e.loaded-newstartsize)*1000/(tmptime.getTime()-StartTime.getTime()))+'/s<br><!--constStr@CurrentSpeed--> '+size_format(tmpspeed)+'/s <!--constStr@Expect--> '+seconds2hour(remaintime.toFixed(1));
                        }
                    }
                    var C_starttime = new Date();
                    xhr.onload = function(e){
                        if (xhr.status<500) {
                            //console.log(xhr.responseText);
                            //console.log(xhr.getResponseHeader('ETag'));
                        //var response=JSON.parse(xhr.responseText);
                        if (xhr.responseText==''&&xhr.getResponseHeader('ETag')!='') {
                            // 有ETag说明本段上传成功
                            let etag = xhr.getResponseHeader('ETag');
                            //if (etag.substr(0,1)=='"') etag = etag.substr(1);还就要引号！
                            //if (etag.substr(-1)=='"') etag = etag.substr(0, etag.length-1);
                            res['ETag'][chunknum] = etag;
                            localStorage.setItem(filesha1, JSON.stringify(res));
                            chunknum++;
                            asize = bsize + 1;
                            if (chunknum==chunknumtotal) {
                                // 上传结束
                                var xhr1 = new XMLHttpRequest();
                                xhr1.open("POST", '?action=upbigfile');
                                //xhr1.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8");
                                xhr1.setRequestHeader('x-requested-with','XMLHttpRequest');
                                xhr1.onload = function(e){
                                    console.log(xhr1.responseText+','+xhr1.status);
                                    if (xhr1.status==200) {
                                        localStorage.removeItem(filesha1);
<!--AdminStart-->
                                        var html=JSON.parse(xhr1.responseText);
                                        //response.name=file.webkitRelativePath||response.name;
                                        addelement(html);
<!--AdminEnd-->
                                        /*if (totalsize>10*1024*1024) {
                                            var xhr3 = new XMLHttpRequest();
                                            xhr3.open("GET", '?action=del_upload_cache&filelastModified='+file.lastModified+'&filesize='+file.size+'&filename='+filename);
                                            xhr3.setRequestHeader('x-requested-with','XMLHttpRequest');
                                            xhr3.send(null);
                                            xhr3.onload = function(e){
                                                console.log(xhr3.responseText+','+xhr3.status);
                                            }
                                        }*/
                                        EndTime=new Date();
                                        MiddleStr = '<!--constStr@EndAt-->:'+EndTime.toLocaleString()+'<br>';
                                        if (newstartsize==0) {
                                            MiddleStr += '<!--constStr@AverageSpeed-->:'+size_format(totalsize*1000/(EndTime.getTime()-StartTime.getTime()))+'/s<br>';
                                        } else {
                                            MiddleStr += '<!--constStr@ThisTime--><!--constStr@AverageSpeed-->:'+size_format((totalsize-newstartsize)*1000/(EndTime.getTime()-StartTime.getTime()))+'/s<br>';
                                        }
                                        document.getElementById('upfile_td1_'+tdnum).innerHTML='<div style="color:green"><a href="<!--base_disk_path--><!--Path-->'+filename+'?preview" id="upfile_a_'+tdnum+'" target="_blank">'+document.getElementById('upfile_td1_'+tdnum).innerHTML+'</a><br><a href="<!--base_disk_path--><!--Path-->'+filename+'" id="upfile_a1_'+tdnum+'"></a><!--constStr@UploadComplete--><button onclick="CopyAllDownloadUrl(\'#upfile_a1_'+tdnum+'\');" id="upfile_cpbt_'+tdnum+'" <!--AdminStart--> style="display:none"<!--AdminEnd--> ><!--constStr@CopyUrl--></button></div>';
                                        label.innerHTML=StartStr+MiddleStr;
                                        label.parentNode.style.background = 'rgba(0,80,0,25%)';
                                    } else {
                                        label.innerHTML= '<font color="red">' + xhr1.status + ',' + xhr1.responseText + '</font>';
                                        localStorage.removeItem(filesha1);
                                    }
                                    delete uploading[filename];
                                }
                                xhr1.send('uploadid=' + uploadid + '&fileid=' + fileid + '&etag=' + JSON.stringify(res['ETag']) + '&_admin=' + localStorage.getItem("admin"));
                                // uploadbuttonshow();
                            } else {
                                readblob(asize);
                            }
                        } else {
                            console.log(xhr.status+xhr.responseText);//<PartEtag>
                            if (xhr.status==409) {
                                let str = xhr.responseText;
                                str = str.substr(str.indexOf('<PartEtag>')+10);
                                str = str.substr(0, str.indexOf('</PartEtag>'));
                                res['ETag'][chunknum] = str;
                                localStorage.setItem(filesha1, JSON.stringify(res));
                                chunknum++;
                                asize += chunksize;
                                readblob(asize);
                            } else {
                                delete uploading[filename];
                            }
                                //label.innerHTML='<font color="red">'+xhr.responseText+'</font><br>';
                        } } else readblob(asize);
                    }
                    xhr.send(binary);
                }
            }
        }
    }
<!--AliyundriveUploadJsEnd-->
<!--GoogledriveUploadJsStart-->
    function preup() {
        alert("Stop!\nCan not upload form explorer without token.");
    }
<!--GoogledriveUploadJsEnd-->
<!--ListEnd-->
    function operatediv_close(operate) {
        document.getElementById(operate+'_div').style.display='none';
        document.getElementById('mask').style.display='none';
    }
<!--AdminStart-->
    function logout() {
        var expd = new Date();
        expd.setTime(expd.getTime()+1000);
        var expires = "expires="+expd.toGMTString();
        document.cookie = "admin=; path=<!--base_path-->; "+expires;
        location.href = location.href;
    }
    /*for some mobile browser*/
    function menu_click(e){
        var ee=document.getElementsByClassName("active");
        for(var i=0;i<ee.length;i++){
            ee[i].classList.remove("active");
        }
        if(e.type!="mouseout")this.classList.add("active");
    }
    (function(){
        var e=document.getElementsByClassName("operate");
        document.body.addEventListener("touchstart", menu_click);
        for(var i=0;i<e.length;i++){
            e[i].addEventListener("touchstart", menu_click);
            e[i].addEventListener("mouseout", menu_click);
        }
    })();
<!--IsFolderStart-->
    function showdiv(event,action,num) {
        var $operatediv=document.getElementsByName('operatediv');
        for ($i=0;$i<$operatediv.length;$i++) {
            $operatediv[$i].style.display='none';
        }
        document.getElementById('mask').style.display='';
        //document.getElementById('mask').style.width=document.documentElement.scrollWidth+'px';
        document.getElementById('mask').style.height=document.documentElement.scrollHeight<window.innerHeight?window.innerHeight:document.documentElement.scrollHeight+'px';
        var str;
        if (num=='') {
            str = '';
            num = 0;
        } else {
            str = decodeURIComponent(document.getElementById('file_a'+num).href);
            if (str.substr(-1)==' ') str=str.substr(0, str.length-1);
            if (str.substr(-1)=='/') str=str.substr(0, str.length-1);
            if (str.substr(-8)=='?preview') str=str.substr(0, str.length-8);
            if (str.lastIndexOf('/')>-1) str=str.substr(str.lastIndexOf('/')+1);
        }
        var fileid = document.getElementById('file_a'+num).attributes['fileid'].nodeValue;
        document.getElementById(action + '_div').style.display='';
        document.getElementById(action + '_label').innerText=str;//.replace(/&/,'&amp;');
        document.getElementById(action + '_sid').value=num;
        document.getElementById(action + '_fileid').value=fileid;
        document.getElementById(action + '_hidden').value=str;
        if (action=='rename') document.getElementById(action + '_input').value=str;
        /*var $e = event || window.event;
        var $scrollX = document.documentElement.scrollLeft || document.body.scrollLeft;*/
        var $scrollY = document.documentElement.scrollTop || document.body.scrollTop;
        /*var $x = $e.pageX || $e.clientX + $scrollX;
        var $y = $e.pageY || $e.clientY + $scrollY;
        if (action=='create') {*/
            document.getElementById(action + '_div').style.left=(document.body.clientWidth-document.getElementById(action + '_div').offsetWidth)/2 +'px';
            document.getElementById(action + '_div').style.top=(window.innerHeight-document.getElementById(action + '_div').offsetHeight)/2+$scrollY +'px';
        /*} else {
            if ($x + document.getElementById(action + '_div').offsetWidth > document.body.clientWidth) {
                if (document.getElementById(action + '_div').offsetWidth > document.body.clientWidth) {
                    document.getElementById(action + '_div').offsetWidth=document.body.clientWidth+'px';
                    document.getElementById(action + '_div').style.left='0px';
                } else {
                    document.getElementById(action + '_div').style.left=document.body.clientWidth-document.getElementById(action + '_div').offsetWidth+'px';
                }
            } else {
                document.getElementById(action + '_div').style.left=$x+'px';
            }
            document.getElementById(action + '_div').style.top=$y+'px';
        }*/
        document.getElementById(action + '_input').focus();
    }
    function submit_operate(str) {
        var num=document.getElementById(str+'_sid').value;
        var xhr = new XMLHttpRequest();
        xhr.open("POST", '');
        xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8");
        xhr.setRequestHeader('x-requested-with', 'XMLHttpRequest');
        xhr.onload = function(e){
            var html;
            if (xhr.status<300) {
                console.log(xhr.status+','+xhr.responseText);
                if (str=='rename') {
                    html=JSON.parse(xhr.responseText);
                    var file_a = document.getElementById('file_a'+num);
                    file_a.innerText=html.name;
                    file_a.href = (file_a.href.substr(-8)=='?preview')?(html.name.replace(/#/,'%23')+'?preview'):(html.name.replace(/#/,'%23')+'/');
                }
                if (str=='move'||str=='delete') document.getElementById('tr'+num).parentNode.removeChild(document.getElementById('tr'+num));
                if (str=='create') {
                    html=JSON.parse(xhr.responseText);
                    addelement(html);
                }
                //alert('success');
            } else alert(xhr.status+'\n'+xhr.responseText);
            document.getElementById(str+'_div').style.display='none';
            document.getElementById('mask').style.display='none';
        }
        xhr.send(serializeForm(str+'_form') + '&_admin=' + localStorage.getItem("admin"));
        return false;
    }
    function addelement(html) {
        var tr1=document.createElement('tr');
        tr1.setAttribute('data-to',1);
        var td1=document.createElement('td');
        td1.setAttribute('class','file');
        var a1=document.createElement('a');
        a1.href='<!--base_disk_path--><!--Path-->'+html.name.replace(/#/,'%23');
        a1.innerText=html.name;
        a1.target='_blank';
        var td2=document.createElement('td');
        td2.setAttribute('class','updated_at');
        if (!!html.time) td2.innerText=html.time.replace(/T/,' ').replace(/Z/,'');
        var td3=document.createElement('td');
        td3.setAttribute('class','size');
        if (!!html.size) td3.innerText=size_format(html.size);
        else td3.innerText='0 B';
        if (html.type=='folder') {
            a1.href+='/';
            document.getElementById('tr0').parentNode.insertBefore(tr1,document.getElementById('tr0').nextSibling);
        }
        if (html.type=='file') {
            a1.href+='?preview';
            a1.name='filelist';
            document.getElementById('tr0').parentNode.appendChild(tr1);
        }
        tr1.appendChild(td1);
        td1.appendChild(a1);
        tr1.appendChild(td2);
        tr1.appendChild(td3);
    }
    function getElements(formId) {
        var form = document.getElementById(formId);
        var elements = new Array();
        var tagElements = form.getElementsByTagName('input');
        for (var j = 0; j < tagElements.length; j++){
            elements.push(tagElements[j]);
        }
        var tagElements = form.getElementsByTagName('select');
        for (var j = 0; j < tagElements.length; j++){
            elements.push(tagElements[j]);
        }
        var tagElements = form.getElementsByTagName('textarea');
        for (var j = 0; j < tagElements.length; j++){
            elements.push(tagElements[j]);
        }
        return elements;
    }
    function serializeElement(element) {
        var method = element.tagName.toLowerCase();
        var parameter;
        if (method == 'select') {
            parameter = [element.name, element.value];
        }
        switch (element.type.toLowerCase()) {
            case 'submit':
            case 'hidden':
            case 'password':
            case 'text':
            case 'date':
            case 'textarea':
                parameter = [element.name, element.value];
                break;
            case 'checkbox':
            case 'radio':
                if (element.checked){
                    parameter = [element.name, element.value];
                }
                break;
        }
        if (parameter) {
            var key = encodeURIComponent(parameter[0]);
            if (key.length == 0) return;
            if (parameter[1].constructor != Array) parameter[1] = [parameter[1]];
            var values = parameter[1];
            var results = [];
            for (var i = 0; i < values.length; i++) {
                results.push(key + '=' + encodeURIComponent(values[i]));
            }
            return results.join('&');
        }
    }
    function serializeForm(formId) {
        var elements = getElements(formId);
        var queryComponents = new Array();
        for (var i = 0; i < elements.length; i++) {
            var queryComponent = serializeElement(elements[i]);
            if (queryComponent) {
                queryComponents.push(queryComponent);
            }
        }
        return queryComponents.join('&');
    }
<!--IsFolderEnd-->
<!--AdminEnd-->
<!--EncryptedStart-->
    document.getElementById('password1').focus();
<!--EncryptedEnd-->
</script>
<script src="https://www.unpkg.com/ionicons@6.0.1/dist/ionicons.js"></script>
<!--LoginStart--><script src="?jsFile=sha1.min.js"></script><!--LoginEnd-->
<!--customScript-->

</html>
